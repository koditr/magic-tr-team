# -*- coding: utf-8 -*-import xbmcplugin,xbmcgui,xbmcaddon,xbmc,urllib,urllib2,os,sys,reimport time,mechanize,base64from BeautifulSoup import BeautifulStoneSoup, BeautifulSoup, BeautifulSOAP as BSfileName ="Sinema1"__settings__ = xbmcaddon.Addon(id='plugin.video.magicTR')__language__ = __settings__.getLocalizedStringhome = __settings__.getAddonInfo('path')folders = xbmc.translatePath(os.path.join(home, 'resources', 'lib'))sys.path.append(folders)import xbmctools,cozuculerxbmcPlayer = xbmc.Player()playList = xbmc.PlayList(xbmc.PLAYLIST_VIDEO)addon_icon    = __settings__.getAddonInfo('icon')def main():        try:                html = xbmctools.sifre()                name=__settings__.getSetting("Name")                login=__settings__.getSetting("Username")                password=__settings__.getSetting("password")                match = re.compile('<!--1SS(.*?)-->').findall(html)                for web in match:                        web=xbmctools.angel(base64.b64decode(web))                        tr=re.compile('<link>(.*?)</link>').findall(web)                        for sinema in tr:                                xbmctools.addDir(fileName,'[COLOR yellow][B]>>[/B][/COLOR] [COLOR red][B]>> - Arama/Search -<< [/B][/COLOR]', "Arama()",sinema,"special://home/addons/plugin.video.magicTR/resources/images/search.png",'special://home/addons/plugin.video.magicTR/fanart.jpg' )                                xbmctools.addDir(fileName,'[COLOR blue][B]>>[/B][/COLOR] [COLOR lightblue][B]Yeni Eklenen Filmler [/B][/COLOR]', "sinemaRecent2(url)",sinema,"",'special://home/addons/plugin.video.magicTR/fanart.jpg')                                xbmctools.addDir(fileName,'[COLOR blue][B]>>[/B][/COLOR] [COLOR orange][B]Sinema Kategoriler [/B][/COLOR]', "Kategoriler()",sinema,"",'special://home/addons/plugin.video.magicTR/fanart.jpg' )                                xbmctools.addDir(fileName,'[COLOR blue][B]>>[/B][/COLOR] [COLOR yellow][B]Yillara Gore Kategoriler [/B][/COLOR]', "Kategorileryil()",sinema,"",'special://home/addons/plugin.video.magicTR/fanart.jpg' )        except:                showMessage("[COLOR blue][B]MagicTR[/B][/COLOR]","[COLOR blue][B]IP Adresiniz Kitlendi[/B][/COLOR]","[COLOR red][B]Lutfen Musteri Hizmetlerine Basvurun!! koditr.media@gmail.com[/B][/COLOR]")                dialog = xbmcgui.DialogProgress()                dialog1 = xbmcgui.Dialog()                dialog1.ok('[COLOR red][B]Hesabiniz Kitlendi[/B][/COLOR]','[COLOR yellow][B] Lutfen Musteri Hizmetlerine Basvurun!! koditr.media@gmail.com[/B][/COLOR]')                sys.exit()def Kategoriler():               html = xbmctools.sifre()        name=__settings__.getSetting("Name")        login=__settings__.getSetting("Username")        password=__settings__.getSetting("password")        if name in html:                match = re.compile('<!-- S1(.*?)-->').findall(html)                if match:                        for web in match:                                web=xbmctools.angel(base64.b64decode(web))                                tr=re.compile('<link>(.*?)</link>').findall(web)                                for sinema in tr:                                        link=xbmctools.get_url(sinema)                                        soup = BeautifulSoup(link)                                        panel = soup.findAll("div", {"class": "categories"})                                        liste=BeautifulSoup(str(panel))                                        for li in liste.findAll('li'):                                                a=li.find('a')                                                url= a['href']                                                name= li.text                                                name=name.encode('utf-8', 'ignore')                                                name=replace_fix(name)                                                if "Erotik" in name:                                                        pass                                                elif "TIKLAYIN" in name:                                                        pass                                                else:                                                                                                                xbmctools.addDir(fileName,'[COLOR beige][B][COLOR blue]>>[/COLOR]'+name+'[/B][/COLOR]', "sinemaRecent(url)",url,"")def Kategorileryil():               html = xbmctools.sifre()        name=__settings__.getSetting("Name")        login=__settings__.getSetting("Username")        password=__settings__.getSetting("password")        if name in html:                match = re.compile('<!-- S1(.*?)-->').findall(html)                if match:                        for web in match:                                web=xbmctools.angel(base64.b64decode(web))                                tr=re.compile('<link>(.*?)</link>').findall(web)                                for sinema in tr:                                        link=xbmctools.get_url(sinema)                                        soup = BeautifulSoup(link)                                        panel = soup.findAll("div", {"class": "dcjq-accordion"})                                        liste=BeautifulSoup(str(panel))                                        for li in liste.findAll('li'):                                                a=li.find('a')                                                url= a['href']                                                name= li.text                                                name=name.encode('utf-8', 'ignore')                                                name=replace_fix(name)                                                if "Erotik" in name:                                                        pass                                                elif "TIKLAYIN" in name:                                                        pass                                                else:                                                                                                                xbmctools.addDir(fileName,'[COLOR beige][B][COLOR blue]>>[/COLOR]'+name+'[/B][/COLOR]', "sinemaRecent(url)",url,"")def Arama():        html = xbmctools.sifre()        name=__settings__.getSetting("Name")        login=__settings__.getSetting("Username")        password=__settings__.getSetting("password")        if name in html:                match = re.compile('<!-- S1(.*?)-->').findall(html)                if match:                        for web in match:                                        web=xbmctools.angel(base64.b64decode(web))                                        tr=re.compile('<link>(.*?)</link>').findall(web)                                        for sinema in tr:                                                keyboard = xbmc.Keyboard("", 'Search', False)                                                keyboard.doModal()                                                if keyboard.isConfirmed():                                                    query = keyboard.getText()                                                    url = (sinema+'/?s='+query)                                                    sinemaRecent(url)def sinemaRecent2(url):        link=xbmctools.get_url(url)        soup = BeautifulSoup(link)        panel = soup.findAll("div", {"id": "contentcontainer"})        panel = panel[0].findAll("div", {"class": "postlistbox"})        for i in range (len (panel)):                url=panel[i].find('a')['href']                               thumbnail=panel[i].find('img')['src'].encode('utf-8', 'ignore')                div2=panel[i].findAll("h2", {"class": "postlisttitle"},smartQuotesTo=None)                name=div2[0].text.encode('utf-8', 'ignore')                name=name.replace("&#8211;"," - ")                xbmctools.addDir(fileName,'[COLOR beige][B][COLOR red]>>[/COLOR]'+name+'[/B][/COLOR]', "ayrisdirma2(url)",url,thumbnail,thumbnail)        page=re.compile('<span class=\'page current\'>.*?</span><a href=\'(.*?)\' class=\'page paginate\' >(.*?)</a>').findall(link)        for url,name in page:                xbmctools.addDir(fileName,'[COLOR blue][B]Sonraki Sayfa >>[/B][/COLOR]'+ '[COLOR red][B]'+name+'[/B][/COLOR]', "sinemaRecent2(url)",url,"special://home/addons/plugin.video.magicTR/resources/images/sonrakisayfa.png")def sinemaRecent(url):        link=xbmctools.get_url(url)        soup = BeautifulSoup(link)        panel = soup.findAll("div", {"class": "two-column"})        liste=BeautifulSoup(str(panel))        for li in liste.findAll('figure'):                a=li.find('a')                img=li.find('img')                url= a['href']                name=a['title'].encode('utf-8', 'ignore')                name=name.replace('&#8217','').replace('&#8211','')                thumbnail=img['src'].encode('utf-8', 'ignore')                xbmctools.addDir(fileName,'[COLOR beige][B][COLOR red]>>[/COLOR]'+name+'[/B][/COLOR]', "ayrisdirma(url)",url,thumbnail,thumbnail)        page=re.compile('class=\'page-numbers current\'>.*?</span>\n<a class=\'page-numbers\' href=\'(.*?)\'>(.*?)</a>').findall(link)        for url,name in page:                xbmctools.addDir(fileName,'[COLOR blue][B]Sonraki Sayfa >>[/B][/COLOR]'+ '[COLOR red][B]'+name+'[/B][/COLOR]', "sinemaRecent(url)",url,"special://home/addons/plugin.video.magicTR/resources/images/sonrakisayfa.png")def ayrisdirma2(url):                link=xbmctools.get_url(url)        link=link.replace('&#038;','&')        match1=re.compile('youtube.com\/embed\/(.*?)"').findall(link)        for url in match1:                url = 'http://www.youtube.com/embed/'+str(url).encode('utf-8', 'ignore')                name='[COLOR beige][B][COLOR red]>>[/COLOR]'+'Fragman'+'[/COLOR]'                xbmctools.addDir(fileName,'[COLOR lightyellow][B]'+name+'[/B][/COLOR]',"cozuculer.magix_player(name,url)",url,'')        match2=re.compile('src="http://ok.ru/videoembed/(.*?)"').findall(link)        for url in match2:                url = 'http://ok.ru/videoembed/'+str(url).encode('utf-8', 'ignore')                name='[COLOR beige][B][COLOR red]>>[/COLOR]'+'Film'+'[/COLOR]'                xbmctools.addDir(fileName,'[COLOR lightyellow][B]'+name+'[/B][/COLOR]',"cozuculer.ok_ru(url)",url,'')        match3=re.compile('video_ext.php?(.*?)"').findall(link)        for url in match3:                url = 'http://vk.com/video_ext.php'+str(url).encode('utf-8', 'ignore')                name='[COLOR beige][B][COLOR red]>>[/COLOR]'+'Film'+'[/COLOR]'                xbmctools.addDir(fileName,'[COLOR lightyellow][B]'+name+'[/B][/COLOR]',"cozuculer.vk_player(name,url)",url,'')        match4=re.compile('http.*?:\/\/.*?\/mail\/(.*?).html').findall(link)        for url in match4:                url = 'http://videoapi.my.mail.ru/videos/embed/mail/'+str(url)+'.html'                name='[COLOR beige][B][COLOR red]>>[/COLOR]'+'Film'+'[/COLOR]'                xbmctools.addDir(fileName,'[COLOR lightyellow][B]'+name+'[/B][/COLOR]',"cozuculer.MailRu_Player(url)",url,'')def ayrisdirma(url):        url=url+'/4'                listeler=[]        urller=[]        link=xbmctools.get_url(url)        soup = BeautifulSoup(link)        panel=soup.find("div", {"id": "woca-pagination"})        for a in panel.findAll('a'):            url=a['href']            name= a.text            listeler.append('[COLOR beige][B][COLOR red]>>[/COLOR]'+name+'[/B][/COLOR]')            urller.append(url)                    ##        url1=url##        link=xbmctools.get_url(url1)##        match1=re.compile('Alternatif</a><a href="http://filmtvizle.biz/(.*?)">Fragman</a>').findall(link)##        for url5 in match1:##                url5='http://filmtvizle.biz/'+url5##                name='[COLOR beige][B][COLOR red]>>[/COLOR]'+'Fragman'+'[/B][/COLOR]'##        match2=re.compile('\-page\'>film</span><a href="http:\/\/filmtvizle.biz\/(.*?).html/2">Fragman</a>').findall(link)##        for url6 in match2:##                url6='http://filmtvizle.biz/'+url6+'.html/2'##                name='[COLOR beige][B][COLOR red]>>[/COLOR]'+'Fragman'+'[/B][/COLOR]'##        match=re.compile('current-page\'>(.*?)ilm</span>').findall(link)##        for code in match:##                url=url1##                code=''##                name='[COLOR beige][B][COLOR red]>>[/COLOR]'+'Server 1'+'[/B][/COLOR]'##        match3=re.compile('href="http://filmtvizle.biz/(.*?)">Alternatif</a>').findall(link)##        for url3 in match3:##                url3='http://filmtvizle.biz/'+url3##                name='[COLOR beige][B][COLOR red]>>[/COLOR]'+'Alternatif'+'[/B][/COLOR]'##        if match1:##                listeler.append('[COLOR red]'+'[B]'+'Fragman Izle'+'[/B]'+'[/COLOR]')##                urller.append(url5)##        if match2:##                listeler.append('[COLOR blue]'+'[B]'+'Film Izle'+'[COLOR red]'+'[B]'+'  '+'{Fragman Izle}'+'[/B]'+'[/COLOR]')##                urller.append(url6)##        if match:##                listeler.append('[COLOR gold]'+'[B]'+'Film Izle'+'[COLOR beige]'+'[B]'+'  '+'{Server 1}'+'[/B]'+'[/COLOR]')##                urller.append(url1)##        if match3:##                listeler.append('[COLOR blue]'+'[B]'+'Film Izle'+'[COLOR beige]'+'[B]'+'  '+'{Alternatif}'+'[/B]'+'[/COLOR]')##                urller.append(url3)                        dialog = xbmcgui.Dialog()        secenek = dialog.select('Izleme Secenekleri...',listeler)        for i in range(len(listeler)):                  if secenek == i:           url=urller[i]           VIDEOLINKS(name,url)                      return url         else:           passdef VIDEOLINKS(name,url):                #---------------------------#        urlList=[]        #---------------------------#        playList.clear()        link=xbmctools.get_url(url)        link=link.replace('&amp;', '&').replace('&#038;', '&').replace('%3A',':').replace('%2F','/').replace('%3F','?').replace('%3D','=').replace('%26','&').replace('%2F','/')		#---------------------------------------------#        ok=re.compile('src="http://ok.ru/videoembed/(.*?)"').findall(link)        for url in ok:                url = 'http://ok.ru/videoembed/'+str(url).encode('utf-8', 'ignore')                cozuculer.ok_ru(url)		#---------------------------------------------#        vk_2=re.compile('src="http://vk.com/(.*?)"').findall(link)        for url in vk_2:                url = 'http://vk.com/'+str(url).encode('utf-8', 'ignore')                cozuculer.vk_player(name,url)		#---------------------------------------------#        vk_3=re.compile('rc="http://snnyk.com/(.*?)"').findall(link)        for url1 in vk_3:                url1=url1.replace('&amp;', '&').replace('&#038;', '&').replace('%3A',':').replace('%2F','/').replace('%3F','?').replace('%3D','=').replace('%26','&').replace('%2F','/')                url1 = 'http://snnyk.com/'+str(url1).encode('utf-8', 'ignore')                link=xbmctools.get_url(url1)                vkvk=re.compile('param\[5\] \+ \'(.*?)\' \+ param\[6\] \+ \'(.*?)\' \+ param\[7\] \+ \'(.*?)\' \+').findall(link)                for oid,vidid,has in vkvk:                        url='https://api.vk.com/method/video.getEmbed?oid='+oid+'&video_id='+vidid+'&embed_hash='+has                        cozuculer.vk2_player(name,url)		#---------------------------------------------#        youtube=re.compile('youtube.com\/embed\/(.*?)"').findall(link)        for url in youtube:                url = 'http://www.youtube.com/embed/'+str(url).encode('utf-8', 'ignore')                cozuculer.magix_player(name,url)		#---------------------------------------------#        mailru2=re.compile('<iframe src=.*?ttp://videoapi.my.mail.ru/videos/embed/mail/(.*?).html').findall(link)        for mailrugelen in mailru2:                url = 'http://videoapi.my.mail.ru/videos/embed/mail/'+mailrugelen+'.html'                value=[]                value.append((name,cozuculer.MailRu_Player(url)))		#---------------------------------------------#        if not urlList:                match=re.compile('flashvars="file=(.*?)%3F.*?" />').findall(link)                if match:                        for url in match:                                VIDEOLINKS(name,url)               if urlList:                Sonuc=playerdenetle(name, urlList)                for name,url in Sonuc:                        xbmctools.addLink(name,url,'')                        listitem = xbmcgui.ListItem(name, iconImage="DefaultFolder.png", thumbnailImage='')                        listitem.setInfo('video', {'name': name } )                        playList.add(url,listitem=listitem)                xbmcPlayer.play(playList)     def playerdenetle(name, urlList):        value=[]        import cozuculer        for url in urlList if not isinstance(urlList, basestring) else [urlList]:                if "mail.ru" in url:                        value.append((name,cozuculer.MailRu_Player(url)))         if  value:            return valuedef name_fix(x):                x=x.replace('-',' ')        return x[0].capitalize() + x[1:]def replace_fix(x):                x=x.replace('&#8211;', '-').replace('&#038;', '&').replace('&amp;', '&').replace('&#8217;', "'").replace("2000'ler"," [COLOR red]<<<<<<<<<<<<[/COLOR][COLOR beige]2000'li Yillar Asagidadir[/COLOR][COLOR red]>>>>>>>>>>>>[/COLOR]").replace('2012201120102009200820072006200320012000','').replace('193919361931','').replace("1930'lar"," [COLOR red]<<<<<<<<<<<<[/COLOR][COLOR beige]1930'lu Yillar Asagidadir[/COLOR][COLOR red]>>>>>>>>>>>>[/COLOR]").replace('1948194619451944194219411940','').replace("1940'lar"," [COLOR red]<<<<<<<<<<<<[/COLOR][COLOR beige]1940'li Yillar Asagidadir[/COLOR][COLOR red]>>>>>>>>>>>>[/COLOR]").replace('19581957195619551954195319511950','').replace("1950'ler"," [COLOR red]<<<<<<<<<<<<[/COLOR][COLOR beige]1950'li Yillar Asagidadir[/COLOR][COLOR red]>>>>>>>>>>>>[/COLOR]").replace('19691968196719641963196219611960','').replace("1960'lar"," [COLOR red]<<<<<<<<<<<<[/COLOR][COLOR beige]1960'li Yillar Asagidadir[/COLOR][COLOR red]>>>>>>>>>>>>[/COLOR]").replace('1979197819771976197519741973197219711970','').replace("1970'ler"," [COLOR red]<<<<<<<<<<<<[/COLOR][COLOR beige]1970'li Yillar Asagidadir[/COLOR][COLOR red]>>>>>>>>>>>>[/COLOR]").replace('1989198819871986198519841983198219811980','').replace("1980'ler"," [COLOR red]<<<<<<<<<<<<[/COLOR][COLOR beige]1980'li Yillar Asagidadir[/COLOR][COLOR red]>>>>>>>>>>>>[/COLOR]").replace('1999199819971996199519941993199219911990','').replace("1990'lar"," [COLOR red]<<<<<<<<<<<<[/COLOR][COLOR beige]1990'li Yillar Asagidadir[/COLOR][COLOR red]>>>>>>>>>>>>[/COLOR]")        return xdef showMessage(heading='MagicTR', message = '', times = 5000, pics = addon_icon):		try: xbmc.executebuiltin('XBMC.Notification("%s", "%s", %s, "%s")' % (heading, message, times, pics))		except Exception, e:			xbmc.log( '[%s]: showMessage: exec failed [%s]' % (addon_id, e), 2 )